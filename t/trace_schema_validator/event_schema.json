{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"$id": "http://git-scm.com/schemas/event_schema.json",
	"title": "trace2 permissive schema",
	"description": "Permissive schema for trace2 event output that does not fail in the presence of unexpected fields.",

	"definitions": {
		"event_common_fields": {
			"type": "object",
			"properties": {
				"sid": { "type": "string" },
				"thread": { "type": "string" },
				"time": {
					"type": "string",
					"format": "date-time"
				},
				"file": { "type": "string" },
				"line": { "type": "integer" },
				"repo": { "type": "integer" }
			},
			"required": [ "sid", "thread" ]
		},

		"version_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "version" },
						"evt": { "const": "1" },
						"exe": { "type": "string" }
					},
					"required": [ "event", "evt", "exe" ]
				}
			]
		},

		"start_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "start" },
						"t_abs": { "type": "number" },
						"argv": {
							"type": "array",
							"items": { "type": "string" }
						}
					},
					"required": [ "event", "t_abs", "argv" ]
				}
			]
		},

		"exit_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "exit" },
						"t_abs": { "type": "number" },
						"code": { "type": "integer" }
					},
					"required": [ "event", "t_abs", "code" ]
				}
			]
		},

		"atexit_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "atexit" },
						"t_abs": { "type": "number" },
						"code": { "type": "integer" }
					},
					"required": [ "event", "t_abs", "code" ]
				}
			]
		},

		"signal_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "signal" },
						"t_abs": { "type": "number" },
						"signo": { "type": "integer" }
					},
					"required": [ "event", "t_abs", "signo" ]
				}
			]
		},

		"error_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "error" },
						"msg": { "type": "string" },
						"fmt": { "type": "string" }
					},
					"required": [ "event", "msg", "fmt" ]
				}
			]
		},

		"cmd_path_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "cmd_path" },
						"path": { "type": "string" }
					},
					"required": [ "event", "path" ]
				}
			]
		},

		"cmd_name_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "cmd_name" },
						"name": { "type": "string" },
						"hierarchy": { "type": "string" }
					},
					"required": [ "event", "name", "hierarchy" ]
				}
			]
		},

		"cmd_mode_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "cmd_mode" },
						"name": { "type": "string" }
					},
					"required": [ "event", "name" ]
				}
			]
		},

		"alias_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "alias" },
						"alias": { "type": "string" },
						"argv": {
							"type": "array",
							"items": { "type": "string" }
						}
					},
					"required": [ "event", "alias", "argv" ]
				}
			]
		},

		"child_start_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "child_start" },
						"child_id": { "type": "integer" },
						"child_class": { "type": "string" },
						"use_shell": { "type": "boolean" },
						"argv": {
							"type": "array",
							"items": { "type": "string" }
						},
						"hook_name": { "type": "string" },
						"cd": { "type": "string" }
					},
					"required": [
						"event", "child_id", "child_class", "use_shell", "argv"
					]
				}
			]
		},

		"child_exit_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "child_exit" },
						"child_id": { "type": "integer" },
						"pid": { "type": "integer" },
						"code": { "type": "integer" },
						"t_rel": { "type": "number" }
					},
					"required": [ "event", "child_id", "pid", "code", "t_rel" ]
				}
			]
		},

		"exec_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "exec" },
						"exec_id": { "type": "integer" },
						"exe": { "type": "string" },
						"argv": {
							"type": "array",
							"items": { "type": "string" }
						}
					},
					"required": [ "event", "exec_id", "exe", "argv" ]
				}
			]
		},

		"exec_result_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "exec_result" },
						"exec_id": { "type": "integer" },
						"code": { "type": "integer" }
					},
					"required": [ "event", "exec_id", "code" ]
				}
			]
		},

		"thread_start_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "thread_start" },
						"thread": { "type": "string" }
					},
					"required": [ "event", "thread" ]
				}
			]
		},

		"thread_exit_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "thread_exit" },
						"thread": { "type": "string" },
						"t_rel": { "type": "number" }
					},
					"required": [ "event", "thread", "t_rel" ]
				}
			]
		},

		"def_param_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "def_param" },
						"param": { "type": "string" },
						"value": { "type": "string" }
					},
					"required": [ "event", "param", "value" ]
				}
			]
		},

		"def_repo_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "def_repo" },
						"repo": { "type": "integer" },
						"worktree": { "type": "string" }
					},
					"required": [ "event", "repo", "worktree" ]
				}
			]
		},

		"region_enter_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "region_enter" },
						"repo": { "type": "integer" },
						"nesting": { "type": "integer" },
						"category": { "type": "string" },
						"label": { "type": "string" },
						"msg": { "type": "string" }
					},
					"required": [ "event", "nesting" ]
				}
			]
		},

		"region_leave_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "region_leave" },
						"repo": { "type": "integer" },
						"t_rel": { "type": "number" },
						"nesting": { "type": "integer" },
						"category": { "type": "string" },
						"label": { "type": "string" },
						"msg": { "type": "string" }
					},
					"required": [ "event", "t_rel", "nesting" ]
				}
			]
		},

		"data_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "data" },
						"repo": { "type": "integer" },
						"t_abs": { "type": "number" },
						"t_rel": { "type": "number" },
						"nesting": { "type": "integer" },
						"category": { "type": "string" },
						"key": { "type": "string" },
						"value": { "type": "string" }
					},
					"required": [
						"event", "t_abs", "t_rel", "nesting", "category", "key",
						"value"
					]
				}
			]
		},

		"data-json_event": {
			"allOf": [
				{ "$ref": "#/definitions/event_common_fields" },
				{
					"properties": {
						"event": { "const": "data-json" },
						"repo": { "type": "integer" },
						"t_abs": { "type": "number" },
						"t_rel": { "type": "number" },
						"nesting": { "type": "integer" },
						"category": { "type": "string" },
						"key": { "type": "string" },
						"value": { "type": "object" }
					},
					"required": [
						"event", "t_abs", "t_rel", "nesting", "category", "key",
						"value"
					]
				}
			]
		}
	},

	"oneOf": [
		{ "$ref": "#/definitions/version_event" },
		{ "$ref": "#/definitions/start_event" },
		{ "$ref": "#/definitions/exit_event" },
		{ "$ref": "#/definitions/atexit_event" },
		{ "$ref": "#/definitions/signal_event" },
		{ "$ref": "#/definitions/error_event" },
		{ "$ref": "#/definitions/cmd_path_event" },
		{ "$ref": "#/definitions/cmd_name_event" },
		{ "$ref": "#/definitions/cmd_mode_event" },
		{ "$ref": "#/definitions/alias_event" },
		{ "$ref": "#/definitions/child_start_event" },
		{ "$ref": "#/definitions/child_exit_event" },
		{ "$ref": "#/definitions/exec_event" },
		{ "$ref": "#/definitions/exec_result_event" },
		{ "$ref": "#/definitions/thread_start_event" },
		{ "$ref": "#/definitions/thread_exit_event" },
		{ "$ref": "#/definitions/def_param_event" },
		{ "$ref": "#/definitions/def_repo_event" },
		{ "$ref": "#/definitions/region_enter_event" },
		{ "$ref": "#/definitions/region_leave_event" },
		{ "$ref": "#/definitions/data_event" },
		{ "$ref": "#/definitions/data-json_event" }
	]
}
